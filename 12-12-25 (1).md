# Feature Documentation: AI-Driven Fraud Detection

This document outlines the **Geospatial Analysis** and **Text Consistency** modules implemented for the Smart Seva fraud detection system. It includes the core logic, implementation details, and **real-world examples** derived from actual test runs on certificate images.

---

## 1. Geospatial Analysis (LLM-Based)
**Module**: [src/services/modules/fraud_detection/geospatial_analysis.py](file:///c:/Users/sudik/OneDrive/Desktop/Mindcres/ai-space/smart_seva/server/src/services/modules/fraud_detection/geospatial_analysis.py)

### logic
This module verifies if the **Issuing Authority** has valid jurisdiction over the **Applicant's Address**. It uses an LLM (Groq/Llama-3) to perform cognitive checks that strict database lookups cannot handle.

**Key Checks:**
1.  **Administrative Hierarchy**: Matches State -> District -> Mandal/Tehsil levels.
2.  **Distance Plausibility**: Evaluates if the distance between the applicant and the office is reasonable.

### Real-World Example: Valid Match
**File**: [income.jpeg](file:///c:/Users/sudik/OneDrive/Desktop/Mindcres/ai-space/smart_seva/server/src/test_data/income.jpeg) (Test Run Output)
**Scenario**: Applicant in *Y.S.R District, Andhra Pradesh* receiving a certificate from the *Andhra Pradesh Revenue Department*.

**System Output:**
```json
"geospatial_analysis": {
  "score": 0,  // Low Risk (Verified)
  "status": "verified",
  "details": {
    "llm_analysis": {
      "reasoning": "Administrative hierarchy: Applicant is in Andhra Pradesh (district Y.S.R.). Issuing authority is a state department in Andhra Pradesh. Hierarchy aligns at the state level... distance (~150-200 km) is reasonable for a citizen to travel for a revenue document.",
      "is_consistent": true,
      "match_level": "State",
      "distance_plausibility": "High",
      "risk_score": 10.0
    }
  }
}
```

### Real-World Example: Jurisdiction Mismatch
**File**: [birth_te.jpeg](file:///c:/Users/sudik/OneDrive/Desktop/Mindcres/ai-space/smart_seva/server/src/test_data/birth_te.jpeg) (Test Run Output)
**Scenario**: Applicant address is a specific hospital (location unknown/unspecified) but Issuer is *Municipal Corporation Kurnool*.

**System Output:**
```json
"geospatial_analysis": {
  "score": 85.0, // High Risk (Mismatch)
  "status": "mismatch",
  "details": {
    "llm_analysis": {
      "reasoning": "Issuing Authority: Municipal Corporation Kurnool... Applicant Address: 'SRI VASAVI APEX HOSPITAL' – no district or state provided... The absence of locality information means the hierarchy cannot be matched...",
      "is_consistent": false,
      "match_level": "Mismatch",
      "distance_plausibility": "Low",
      "risk_score": 85.0
    },
    "flags": ["Jurisdiction Mismatch (Mismatch): ...The absence of locality information..."]
  }
}
```

---

## 2. Text Consistency Validator (NLP)
**Module**: [src/services/modules/fraud_detection/text_consistency_analysis.py](file:///c:/Users/sudik/OneDrive/Desktop/Mindcres/ai-space/smart_seva/server/src/services/modules/fraud_detection/text_consistency_analysis.py)

### Logic
This module analyzes the raw OCR text to detect linguistic "tells" of forgery, such as bad grammar, mismatched tones (informal vs. official), or inconsistent formatting. It explicitly distinguishes between **OCR Artifacts** (scan errors) and **Linguistic Anomalies** (human errors).

### Real-World Example: Poorly Edited Document
**File**: [community.jpeg](file:///c:/Users/sudik/OneDrive/Desktop/Mindcres/ai-space/smart_seva/server/src/test_data/community.jpeg) (Test Run Output)
**Scenario**: A document failing consistency checks due to placeholder text and bad grammar.

**System Output:**
```json
"text_consistency_analysis": {
  "score": 45.0, // Low Consistency Score = High Risk
  "status": "success",
  "details": {
    "analysis": "Actual linguistic anomalies: Placeholder syntax left intact: 'Srl/Srimathl/Kumari'... Incorrect verb forms: 'This is bo certify' (should be 'This is hereby certified')... Misspellings: 'certifled', 'declaratian'...",
    "issues": [
      "[Grammar] - 'This is bo certify that…' – incorrect verb form...",
      "[Format] - Inconsistent capitalization... Mixed spacing..."
    ],
    "tone": "The intended tone appears to be Formal... but due to numerous errors... the actual tone is compromised.",
    "grammar_issues": "- 'This is bo certify that…' – incorrect verb form...",
    "formatting_issues": "- Inconsistent capitalization... 'VIZIANAGARAM', 'Vizianagaram'..."
  }
}
```

---

## 3. Integrated Fraud Report
**File**: [nodes/fraud_detection_node.py](file:///c:/Users/sudik/OneDrive/Desktop/Mindcres/ai-space/smart_seva/server/src/services/nodes/fraud_detection_node.py)

The system combines scores from **Pattern**, **Statistical**, **Geospatial**, and **Text Consistency** analyses. The final `overall_score` is the maximum risk detected across any module.

### Final Verification Example
**File**: [birth_te.jpeg](file:///c:/Users/sudik/OneDrive/Desktop/Mindcres/ai-space/smart_seva/server/src/test_data/birth_te.jpeg)

| Module | Risk Score | Findings |
| :--- | :--- | :--- |
| **Pattern** | **85** | All caps text, Placeholder data "XXXXXXXX". |
| **Statistical** | 0 | No value outliers found. |
| **Geospatial** | **85** | Jurisdiction Mismatch (Unknown Hospital Location). |
| **Text Consistency** | **50** | (Inverted Score) Bad grammar, random characters "S0as1". |
| **OVERALL** | **85** | **REJECTED** |

**JSON Response used by Frontend:**
```json
{
  "verification_status": "rejected",
  "fraud_detection": {
    "overall_score": 85,
    "pattern_analysis": { ... },
    "geospatial_analysis": { ... },
    "text_consistency_analysis": { ... }
  }
}
```

---

## Conclusion
The implementation successfully detects diverse fraud vectors:
1.  **Logical Consistency**: Catching jurisdiction mismatches.
2.  **Linguistic Quality**: Catching badly edited templates with typos ("certifled", "declaratian").
3.  **Visual Patterns**: Catching placeholder data ("XXX").

This multi-modal approach significantly raises the bar for generating convincing fake documents.
